

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Universal Quantized File Format: UQFF &#8212; mistral.rs</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="../_static/custom.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'quantization/uqff';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Advanced features" href="../advanced/index.html" />
    <link rel="prev" title="Model topology configuration" href="topology.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/mistralrs-logo-text-light.png" class="logo__image only-light" alt="mistral.rs - Home"/>
    <img src="../_static/mistralrs-logo-text-light.png" class="logo__image only-dark pst-js-only" alt="mistral.rs - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../getting_started/installation.html">Installation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/installation/features.html">Feature flags in mistral.rs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/installation/cli.html">CLI installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/installation/python_pypi.html">Python Installation from PyPi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/installation/python_from_scratch.html">Python Installation from scratch</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/examples.html">Examples</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Python API documentation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../python_docs/api.html"><code class="docutils literal notranslate"><span class="pre">mistralrs</span></code></a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Quantization in mistral.rs</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="isq.html">In situ quantization</a></li>
<li class="toctree-l1"><a class="reference internal" href="quants.html">Quantization in mistral.rs</a></li>
<li class="toctree-l1"><a class="reference internal" href="topology.html">Model topology configuration</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Universal Quantized File Format: UQFF</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced features</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../advanced/index.html">Advanced features</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../advanced/distributed.html">Distributed inference in mistral.rs: Tensor parallelism and Multi-node support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/flash_attention.html">FlashAttention in mistral.rs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/paged_attention.html">PagedAttention in mistral.rs</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/EricLBuehler/mistral.rs" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/EricLBuehler/mistral.rs/edit/main/docs/source/quantization/uqff.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/quantization/uqff.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Universal Quantized File Format: UQFF</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Universal Quantized File Format: UQFF</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#toc">ToC</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation">Motivation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#support">Support</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-a-uqff-model">Loading a UQFF model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-with-the-cli">Running with the CLI</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-with-the-rust-api">Using with the Rust API</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-the-python-api">Using the Python API</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-uqff-model">Creating a UQFF model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-with-the-cli">Creating with the CLI</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-with-the-rust-api">Creating with the Rust API</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-with-the-python-api">Creating with the Python API</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#upload-with-git">Upload with Git</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#list-of-models">List of models</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="universal-quantized-file-format-uqff">
<h1>Universal Quantized File Format: UQFF<a class="headerlink" href="#universal-quantized-file-format-uqff" title="Permalink to this heading">#</a></h1>
<h3 align="left">
The uniquely powerful quantized file format.
</h3>
<ol class="arabic simple">
<li><p><strong>Flexible</strong> 🌀: Multiple quantization formats in <em>one</em> file format with <em>one</em> framework to run them all.</p></li>
<li><p><strong>Reliable</strong> 🔒: Compatibility ensured with <em>embedded</em> and <em>checked</em> semantic versioning information from day 1.</p></li>
<li><p><strong>Easy</strong> 🤗: Download UQFF models <em>easily</em> and <em>quickly</em> from Hugging Face, or use a local file.</p></li>
<li><p><strong>Customizable</strong> 🛠️: Make and publish your own UQFF files in minutes.</p></li>
</ol>
</section>
<section id="toc">
<h1>ToC<a class="headerlink" href="#toc" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="#motivation"><span class="xref myst">Motivation</span></a></p></li>
<li><p><a class="reference internal" href="#support"><span class="xref myst">Support</span></a></p></li>
<li><p><a class="reference internal" href="#loading-a-uqff-model"><span class="xref myst">Loading a UQFF model</span></a></p></li>
<li><p><a class="reference internal" href="#creating-a-uqff-model"><span class="xref myst">Creating a UQFF model</span></a></p></li>
<li><p><a class="reference internal" href="#list-of-models"><span class="xref myst">List of models</span></a></p></li>
<li><p><a class="reference internal" href="#UQFF/LAYOUT.md"><span class="xref myst">Memory layout (<em>for developers</em>)</span></a></p></li>
</ul>
<section id="motivation">
<h2>Motivation<a class="headerlink" href="#motivation" title="Permalink to this heading">#</a></h2>
<p>UQFF builds on our ISQ feature by allowing serialization and deserialization for models.</p>
<p>While ISQ is a powerful feature enabling easy quantization of models, the key limitation has been the time required for requantization. While the process is relatively fast with parallelization and other techniques, multiple runs can make the experience slow.</p>
<p><strong>Comparting UQFF to GGUF:</strong></p>
<p>In contrast to GGUF, which only supports the GGUF quantizations, UQFF is designed with flexibiliuty in mind. At its code, it extends the power and flexibility of ISQ. The ability to support multiple quantization types (more to come!) in one simple, easy-to-use file is a critical feature.</p>
<p>Additionally, users will no longer need to wait for GGUF support to begin using post-training quantized models. As we add new models and quantization schemes to mistral.rs, the feature set of UQFF will grow.</p>
</section>
<section id="support">
<h2>Support<a class="headerlink" href="#support" title="Permalink to this heading">#</a></h2>
<p>The following quantization formats are supported in UQFF. One can, of course, be combined arbitrarily during UQFF generation or ISQ using a <span class="xref myst">model topology</span>. When loading a UQFF model, only the per-layer device mapping feature of the topology applies.</p>
<ul class="simple">
<li><p>GGUF quantized:</p>
<ul>
<li><p>Q4_0</p></li>
<li><p>Q4_1</p></li>
<li><p>Q5_0</p></li>
<li><p>Q5_1</p></li>
<li><p>Q8_0</p></li>
<li><p>Q8_1 (<em>not available on CUDA</em>)</p></li>
<li><p>Q2K</p></li>
<li><p>Q3K</p></li>
<li><p>Q4K</p></li>
<li><p>Q5K</p></li>
<li><p>Q6K</p></li>
<li><p>Q8K  (<em>not available on CUDA</em>)</p></li>
</ul>
</li>
<li><p>HQQ quantized:</p>
<ul>
<li><p>HQQ4</p></li>
<li><p>HQQ8</p></li>
</ul>
</li>
<li><p>FP8:</p>
<ul>
<li><p>FP8 E4M3 (4-bit exponent, 3-bit mantissa)</p></li>
</ul>
</li>
</ul>
</section>
<section id="loading-a-uqff-model">
<h2>Loading a UQFF model<a class="headerlink" href="#loading-a-uqff-model" title="Permalink to this heading">#</a></h2>
<p>To load a UQFF model, one should specify the filename. This will be located based on the model ID, and can
be loaded locally or from Hugging Face based on the model ID.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">phi3.5-mini-instruct-q4k.uqff</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">../UQFF/phi3.5-mini-instruct-q4k.uqff</span></code></p></li>
</ul>
<p>You can find a <a class="reference external" href="https://huggingface.co/collections/EricB/uqff-670e4a49d56ecdd3f7f0fd4c">collection of UQFF models here</a>, which each include a simple
command to get started.</p>
<blockquote>
<div><p>Note: when loading an UQFF model, <em>any</em> ISQ setting will be ignored.</p>
</div></blockquote>
<section id="running-with-the-cli">
<h3>Running with the CLI<a class="headerlink" href="#running-with-the-cli" title="Permalink to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">mistralrs</span><span class="o">-</span><span class="n">server</span> <span class="o">-</span><span class="n">i</span> <span class="n">plain</span> <span class="o">-</span><span class="n">m</span> <span class="n">EricB</span><span class="o">/</span><span class="n">Phi</span><span class="o">-</span><span class="mf">3.5</span><span class="o">-</span><span class="n">mini</span><span class="o">-</span><span class="n">instruct</span><span class="o">-</span><span class="n">UQFF</span> <span class="o">--</span><span class="n">from</span><span class="o">-</span><span class="n">uqff</span> <span class="n">phi3</span><span class="mf">.5</span><span class="o">-</span><span class="n">mini</span><span class="o">-</span><span class="n">instruct</span><span class="o">-</span><span class="n">f8e4m3</span><span class="o">.</span><span class="n">uqff</span>
</pre></div>
</div>
</section>
<section id="using-with-the-rust-api">
<h3>Using with the Rust API<a class="headerlink" href="#using-with-the-rust-api" title="Permalink to this heading">#</a></h3>
<p>Modify the Normal or Vision config as follows and update the model ID to point to a UQFF model:</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span>NormalSpecificConfig {
<span class="w"> </span>   use_flash_attn: false,
<span class="w"> </span>   prompt_batchsize: None,
<span class="w"> </span>   topology: None,
<span class="w"> </span>   organization: Default::default(),
<span class="w"> </span>   write_uqff: None,
<span class="gd">-   from_uqff: None,</span>
<span class="gi">+   from_uqff: Some(&quot;phi3.5-mini-instruct-q4k.uqff&quot;.to_string()), // Pull from specified HF hub repo</span>
}
</pre></div>
</div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span>VisionSpecificConfig {
<span class="w"> </span>   use_flash_attn: false,
<span class="w"> </span>   prompt_batchsize: None,
<span class="w"> </span>   topology: None,
<span class="w"> </span>   write_uqff: None,
<span class="gd">-   from_uqff: None,</span>
<span class="gi">+   from_uqff: Some(&quot;../phi3.5-mini-instruct-q4k.uqff&quot;.to_string()), // Local path</span>
}
</pre></div>
</div>
</section>
<section id="using-the-python-api">
<h3>Using the Python API<a class="headerlink" href="#using-the-python-api" title="Permalink to this heading">#</a></h3>
<p>Modify the <code class="docutils literal notranslate"><span class="pre">Which</span></code> instantiation as follows:</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span>Which.Plain(
<span class="w"> </span>   model_id=&quot;EricB/Phi-3.5-mini-instruct-UQFF&quot;,
<span class="gi">+   from_uqff=&quot;phi3.5-mini-instruct-q4k.uqff&quot;</span>
),
</pre></div>
</div>
</section>
</section>
<section id="creating-a-uqff-model">
<h2>Creating a UQFF model<a class="headerlink" href="#creating-a-uqff-model" title="Permalink to this heading">#</a></h2>
<p>Creating a UQFF model requires you to generate the UQFF file.</p>
<ul class="simple">
<li><p>This means specifying a local path to a file ending in <code class="docutils literal notranslate"><span class="pre">.uqff</span></code>, where your new UQFF model will be created.</p></li>
<li><p>The quantization of a UQFF model is determined from the ISQ or model topology (see the <span class="xref myst">topology docs</span> for more details on how ISQ and the topology mix).</p></li>
</ul>
<p>Along with the UQFF file, the generation process will also output several <code class="docutils literal notranslate"><span class="pre">.json</span></code> configuration files and <code class="docutils literal notranslate"><span class="pre">residual.safetensors</span></code>. All of these files are considered the
UQFF model, and should be kept together or uploaded.</p>
<blockquote>
<div><p>Note: Only the <code class="docutils literal notranslate"><span class="pre">.uqff</span></code> files are unique to the quantization level(s). If you are generating multiple UQFF files, it is OK for the others to be overwritten.</p>
</div></blockquote>
<p>After creating the UQFF file, you can upload the model to Hugging Face. To do this:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://huggingface.co/docs/transformers/v4.17.0/en/create_a_model">Create a new model</a>.</p></li>
<li><p>Upload the UQFF file:</p>
<ul class="simple">
<li><p>With the web interface: <a class="reference external" href="https://huggingface.co/docs/hub/en/models-uploading#using-the-web-interface">guide here</a>.</p></li>
<li><p>With Git: <a class="reference internal" href="#upload-with-git-lfs"><span class="xref myst">steps here</span></a></p></li>
</ul>
</li>
<li><p>Locally, generate the model card file with <a class="reference internal" href="#../scripts/generate_uqff_card.py"><span class="xref myst">this Python script</span></a>..</p></li>
<li><p>In the web interface, press the <code class="docutils literal notranslate"><span class="pre">Create</span> <span class="pre">Model</span> <span class="pre">Card</span></code> button and paste the generated model card.</p></li>
</ol>
<section id="creating-with-the-cli">
<h3>Creating with the CLI<a class="headerlink" href="#creating-with-the-cli" title="Permalink to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">mistralrs</span><span class="o">-</span><span class="n">server</span> <span class="o">--</span><span class="n">isq</span> <span class="n">Q4K</span> <span class="o">-</span><span class="n">i</span> <span class="n">plain</span> <span class="o">-</span><span class="n">m</span> <span class="n">microsoft</span><span class="o">/</span><span class="n">Phi</span><span class="o">-</span><span class="mf">3.5</span><span class="o">-</span><span class="n">mini</span><span class="o">-</span><span class="n">instruct</span> <span class="o">--</span><span class="n">write</span><span class="o">-</span><span class="n">uqff</span> <span class="n">phi3</span><span class="mf">.5</span><span class="o">-</span><span class="n">mini</span><span class="o">-</span><span class="n">instruct</span><span class="o">-</span><span class="n">q4k</span><span class="o">.</span><span class="n">uqff</span>
</pre></div>
</div>
</section>
<section id="creating-with-the-rust-api">
<h3>Creating with the Rust API<a class="headerlink" href="#creating-with-the-rust-api" title="Permalink to this heading">#</a></h3>
<p>Modify the Normal or Vision config as follows:</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span>NormalSpecificConfig {
<span class="w"> </span>   use_flash_attn: false,
<span class="w"> </span>   prompt_batchsize: None,
<span class="w"> </span>   topology: None,
<span class="w"> </span>   organization: Default::default(),
<span class="w"> </span>   from_uqff: None,
<span class="gd">-   write_uqff: None,</span>
<span class="gi">+   write_uqff: Some(&quot;phi3.5-mini-instruct-q4k.uqff&quot;.to_string()),</span>
}
</pre></div>
</div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span>VisionSpecificConfig {
<span class="w"> </span>   use_flash_attn: false,
<span class="w"> </span>   prompt_batchsize: None,
<span class="w"> </span>   topology: None,
<span class="w"> </span>   from_uqff: None,
<span class="gd">-   write_uqff: None,</span>
<span class="gi">+   write_uqff: Some(&quot;../UQFF/phi3.5-mini-instruct-q4k.uqff&quot;.to_string()),</span>
}
</pre></div>
</div>
</section>
<section id="creating-with-the-python-api">
<h3>Creating with the Python API<a class="headerlink" href="#creating-with-the-python-api" title="Permalink to this heading">#</a></h3>
<p>Modify the <code class="docutils literal notranslate"><span class="pre">Which</span></code> instantiation as follows. Be sure to add the <code class="docutils literal notranslate"><span class="pre">in_situ_quant</span></code>.</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span>Which.Plain(
<span class="w"> </span>   model_id=&quot;microsoft/Phi-3.5-mini-instruct&quot;,
<span class="gi">+   write_uqff=&quot;phi3.5-mini-instruct-q4k.uqff&quot;</span>
),
</pre></div>
</div>
</section>
<section id="upload-with-git">
<h3>Upload with Git<a class="headerlink" href="#upload-with-git" title="Permalink to this heading">#</a></h3>
<p>To upload a UQFF model using Git, you will most likely need to set up Git LFS:</p>
<ol class="arabic simple">
<li><p>Install <a class="reference external" href="https://github.com/git-lfs/git-lfs?tab=readme-ov-file#installing">git-lfs</a></p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">lfs</span> <span class="pre">install</span></code></p></li>
<li><p>(If the files are larger than <strong>5GB</strong>) Run <code class="docutils literal notranslate"><span class="pre">huggingface-cli</span> <span class="pre">lfs-enable-largefiles</span> <span class="pre">.</span></code> (you will need to <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">huggingface_hub</span></code>)</p></li>
</ol>
<p>After this, you can use Git to track, commit, and push files.</p>
</section>
</section>
<section id="list-of-models">
<h2>List of models<a class="headerlink" href="#list-of-models" title="Permalink to this heading">#</a></h2>
<p>You can find a list of models in the <a class="reference external" href="https://huggingface.co/collections/EricB/uqff-670e4a49d56ecdd3f7f0fd4c">Hugging Face model collection</a>.</p>
<p>Have you created a UQFF model on Hugging Face? If so, please <a class="reference external" href="https://github.com/EricLBuehler/mistral.rs/issues/new">create an issue</a>.</p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="topology.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Model topology configuration</p>
      </div>
    </a>
    <a class="right-next"
       href="../advanced/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Advanced features</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Universal Quantized File Format: UQFF</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#toc">ToC</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation">Motivation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#support">Support</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-a-uqff-model">Loading a UQFF model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-with-the-cli">Running with the CLI</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-with-the-rust-api">Using with the Rust API</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-the-python-api">Using the Python API</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-uqff-model">Creating a UQFF model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-with-the-cli">Creating with the CLI</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-with-the-rust-api">Creating with the Rust API</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-with-the-python-api">Creating with the Python API</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#upload-with-git">Upload with Git</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#list-of-models">List of models</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Eric Buehler
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025, mistral.rs.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>